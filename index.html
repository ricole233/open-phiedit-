<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>open phiedit 5</title>
	<!-- jQuery -->
	<!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> -->
	<!-- Vue 3 -->
	<!-- <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->
	<!-- SweetAlert2 -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
	<div id="mainUI">
		<audio id="music-player"></audio>
		<!-- 加载反馈音效 -->
		<!-- <audio id="audio-tap" src="./src/audios/notes/tap.wav" preload="auto"></audio>
		<audio id="audio-drag" src="./src/audios/notes/drag.wav" preload="auto"></audio>
		<audio id="audio-flick" src="./src/audios/notes/flick.wav" preload="auto"></audio>
		<audio id="audio-hold" src="./src/audios/notes/hold.wav" preload="auto"></audio> -->
		<div id="downloading">
			保存文件中......
		</div>
		<div style="display:flex">
			<div class="menu">
				文件
				<div>
					<div id="m-load">加载</div>
					<div id="m-save">保存到本地（rpe 格式）</div>
					<div id="m-save2">保存到本地（纯文本多 K 格式）</div>
				</div>
			</div>
			<div class="menu">
				填充
				<div>
					<div id="fillnotes-open">曲线音符</div>
				</div>
			</div>
			<div class="menu">
				编辑
				<div>
					<div id="m-addline">添加判定线</div>
					<div id="m-event">打开/关闭事件</div>
					<div id="m-touch">打开/关闭触控模式</div>
					<div id="m-player">打开/关闭预览</div>
					<div id="m-copy">复制模式：内部剪贴板</div>
				</div>
			</div>
			<div class="menu">
				帮助
				<div>
					<div id="m-help1">制谱器帮助</div>
					<div id="m-help2">pez打包帮助</div>
				</div>
			</div>
		</div>

		<div style="display:flex">
			<div style="border: 1px solid black; width: 72%;">
				<div id="mode" style="display:flex">
					<div class="note-btn" data-mode="computer"><img src="./src/img/1.svg" style="height: 100%;"><span
							class="note-label"></span></div>
					<div class="note-btn" data-mode="q"><img src="./src/img/notes/Tap.png" style="height: 20%;"><span
							class="note-label">Tap</span></div>
					<div class="note-btn" data-mode="w"><img src="./src/img/notes/Drag.png" style="height: 10%;"><span
							class="note-label">Drag</span></div>
					<div class="note-btn" data-mode="e"><img src="./src/img/notes/Flick.png" style="height: 40%;"><span
							class="note-label">Flick</span></div>
					<div class="note-btn" data-mode="r"><img src="./src/img/notes/Hold.png" style="height: 100%;"><span
							class="note-label">Hold</span></div>
					<div style="margin-left: auto; display:flex">
						<img src="./src/img/icon1.svg" style="height: 100%;" id="mobile-phone-play">
						<div style="background: rgb(147, 147, 147); text-align:'center'; padding: 10px; margin-left: 3px; user-select: none;"
							id="mobile-phone-delete">删除</div>
					</div>
				</div>
				<canvas id="cvs" width="1600px" height="900px" style="width: 100%;">
				</canvas>
			</div>
			<div style="width: 25%; display:none" id="edit">
				<h3>音符编辑</h3>
				X坐标：<input id="edit-x" type="number"><br>
				起始时间：<input id="edit-time"><br>
				结束时间：<input id="edit-time2"><br>
				朝向：<select id="edit-d">
					<option value="1">Up</option>
					<option value="2">Down</option>
				</select>
				<br>
				真值：<select id="edit-t">
					<option value="0">普通音符</option>
					<option value="1">假音符</option>
				</select>
				<br>
				Y轴偏移：<input id="edit-y" type="number"><br>
				可视时间：<input id="edit-visibleTime" type="number"><br>
			</div>
			<div style="width: 25%; display:none" id="edit2">
				<h3>事件编辑</h3>
				<p id="event-name"></p>
				缓动类型：<select id="edit2-ease">
					<option value="1">1 linear</option>
					<option value="2">2 sin out</option>
					<option value="3">3 sin in</option>
					<option value="4">4 quad out</option>
					<option value="5">5 quad in</option>
					<option value="6">6 sin io</option>
					<option value="7">7 quad io</option>
					<option value="8">8 cubic out</option>
					<option value="9">9 cubic in</option>
					<option value="10">10 quart out</option>
					<option value="11">11 quart in</option>
					<option value="12">12 cubic io</option>
					<option value="13">13 quart io</option>
					<option value="14">14 quint out</option>
					<option value="15">15 quint in</option>
					<option value="16">16 expo out</option>
					<option value="17">17 expo in</option>
					<option value="18">18 circ out</option>
					<option value="19">19 circ in</option>
					<option value="20">20 back out</option>
					<option value="21">21 back in</option>
					<option value="22">22 circ in</option>
					<option value="23">23 back io</option>
					<option value="24">24 elastic out</option>
					<option value="25">25 elastic in</option>
					<option value="26">26 bounce out</option>
					<option value="27">27 bounce in</option>
					<option value="28">28 bounce io</option>
				</select>
				<br>
				起始时间：<input id="edit2-time"><br>
				结束时间：<input id="edit2-time2"><br>
				起始值：<input id="edit2-st"><br>
				结束值：<input id="edit2-ed"><br>
			</div>
			<div style="width: 25%; display:block" id="edit3">
				<h3>判定线编辑</h3>
				名称：<input id="edit3-name"><br>
				父线：<input id="edit3-fa" type="number"><br>
				bpm倍率：<input id="edit3-bpmfactor" type="number"><br>
			</div>
			<div style="width: 25%; display:none" id="edit4">
				<h3>音符批量编辑</h3>
				数值种类：
				<select id="edit4-t">
					<option value="positionX">X</option>
					<option value="startTime">起始时间</option>
					<option value="endTime">结束时间</option>
					<option value="yOffset">Y轴偏移</option>
					<option value="line">所在判定线（只支持“设为此值”）</option>
				</select><br>
				数值下界：<input id="edit4-v1"><br>
				数值上界：<input id="edit4-v2"><br>
				缓动类型：<select id="edit4-ease">
					<option value="1">1 linear</option>
					<option value="2">2 sin out</option>
					<option value="3">3 sin in</option>
					<option value="4">4 quad out</option>
					<option value="5">5 quad in</option>
					<option value="6">6 sin io</option>
					<option value="7">7 quad io</option>
					<option value="8">8 cubic out</option>
					<option value="9">9 cubic in</option>
					<option value="10">10 quart out</option>
					<option value="11">11 quart in</option>
					<option value="12">12 cubic io</option>
					<option value="13">13 quart io</option>
					<option value="14">14 quint out</option>
					<option value="15">15 quint in</option>
					<option value="16">16 expo out</option>
					<option value="17">17 expo in</option>
					<option value="18">18 circ out</option>
					<option value="19">19 circ in</option>
					<option value="20">20 back out</option>
					<option value="21">21 back in</option>
					<option value="22">22 circ in</option>
					<option value="23">23 back io</option>
					<option value="24">24 elastic out</option>
					<option value="25">25 elastic in</option>
					<option value="26">26 bounce out</option>
					<option value="27">27 bounce in</option>
					<option value="28">28 bounce io</option>
				</select>
				<br>
				修改方式：<select id="edit4-op">
					<option value="add">增加此值</option>
					<option value="set">设为此值</option>
					<option value="mul">乘以此值</option>
					<option value="max">取最大</option>
					<option value="min">取最小</option>
					<option value="flip">以此值为中心翻转</option>
				</select>
				<br>
				周期数列：<input id="edit4-cycle" value="1">
				<br>
				扰动：<input id="edit4-rand" type="number" value="0"><br>
				<button id="edit4-impl">执行</button>
			</div>
		</div>
		<div style="display:flex">
			bpm：
			<div id="s-bpm" style="border: 1px solid; padding: 3px; user-select: none; background: #545454;">80</div>
			&nbsp;
			竖向格子数：
			<input value="1" type="number" id="s-shu" style="width: 100px">
			&nbsp;
			横向格子数：
			<input value="1" type="number" id="s-heng" style="width: 100px">
		</div>
		<!-- 操作栏 -->
		<div style="display:flex">
			<!-- 判定线选择 -->
			<div id="line-selector">
				<div id="line-selected"></div>
				<ul id="lines" style="width: 30%; display: none"></ul>
			</div>
			<span style="-webkit-user-select: none; user-select: none;">&nbsp;</span>
			<!-- 事件层级选择 -->
			<div style="display:flex">
				<div id="eventlayer-ex" class="eventlayer-btn">ex</div>
				<div id="eventlayer-add" class="eventlayer-btn">+</div>
				<div id="eventlayer-del" class="eventlayer-btn">-</div>
				<div id="eventlayer-container-ex" style="display:flex">
					<!-- 动态扩展的容器 -->
					<div id="eventlayer-con" style="display:flex"></div>
				</div>


			</div>
		</div>
	</div>
	<div class="window" id="window-fillnotes">
		<div class="content">
			<h2 style="margin-top:0px; margin-left:5px;">曲线填充音符</h2>
			测试功能<br><br>
			<button class="close-btn" onclick="this.parentNode.parentNode.style.display='none'">&times;</button>
			起始时间：<input id="fillnotes-time"><br>
			结束时间：<input id="fillnotes-time2"><br>
			<input type="checkbox" id="fillnotes-flag">包含边界<br>
			x 起点<input id="fillnotes-x"><br>
			x 终点：<input id="fillnotes-x2"><br>
			填充：<select id="fillnotes-t">
				<option value="1">tap</option>
				<option value="3">flick</option>
				<option value="4" selected>drag</option>
			</select><br>
			密度：<input id="fillnotes-density" value="0:1/4"><br>
			曲线类型：<select id="fillnotes-ease">
				<option value="1">1 linear</option>
				<option value="2">2 sin out</option>
				<option value="3">3 sin in</option>
				<option value="4">4 quad out</option>
				<option value="5">5 quad in</option>
				<option value="6">6 sin io</option>
				<option value="7">7 quad io</option>
				<option value="8">8 cubic out</option>
				<option value="9">9 cubic in</option>
				<option value="10">10 quart out</option>
				<option value="11">11 quart in</option>
				<option value="12">12 cubic io</option>
				<option value="13">13 quart io</option>
				<option value="14">14 quint out</option>
				<option value="15">15 quint in</option>
				<option value="16">16 expo out</option>
				<option value="17">17 expo in</option>
				<option value="18">18 circ out</option>
				<option value="19">19 circ in</option>
				<option value="20">20 back out</option>
				<option value="21">21 back in</option>
				<option value="22">22 circ in</option>
				<option value="23">23 back io</option>
				<option value="24">24 elastic out</option>
				<option value="25">25 elastic in</option>
				<option value="26">26 bounce out</option>
				<option value="27">27 bounce in</option>
				<option value="28">28 bounce io</option>
			</select><br>
			<button id="fillnotes">确认</button>
		</div>
	</div>
	<div class="window" id="window-bpmlist">
		<div class="content" style="overflow-y: auto;">
			<h2 style="margin-top:0px; margin-left:5px;">BPM 管理</h2>
			<button class="close-btn" onclick="this.parentNode.parentNode.style.display='none'">&times;</button>
			<div id="bpmlist">

			</div>
			<button id="bpmlist-add">添加</button>
		</div>
	</div>
	<div class="window" id="window-help">
		<div class="content" style="overflow-y: auto;">
			<h2 style="margin-top:0px; margin-left:5px;">帮助页面</h2>
			<button class="close-btn" onclick="this.parentNode.parentNode.style.display='none'">&times;</button>
			<div id="help-content">

			</div>
		</div>
	</div>
	<div id="contextmenu">
		<div id="contextmenu-toTap">to Tap</div>
		<div id="contextmenu-toDrag">to Drag</div>
		<div id="contextmenu-toFlick">to Flick</div>
		<div id="contextmenu-filp">绕 y 轴翻转</div>
	</div>
	<style>
		/* 弹出窗口 */
		.window {
			background: rgba(0, 0, 0, 0.85);
			z-index: 114514;
			width: 100%;
			height: 100%;
			/* 居中 */
			display: none;
			justify-content: center;
			align-items: center;
			/* 定位 */
			position: fixed;
			left: 0px;
			top: 0px;
		}

		.window>h2 {
			-webkit-user-select: none;
			user-select: none;
		}

		.content {
			background: #2D2D2D;
			color: #E6E6E6;
			padding: 14px;
			/* 定位 */
			position: relative;
			width: 61.8%;
			height: 61.8%;
			border-radius: 3px;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
		}

		.close-btn {
			font-size: 20px;
			font-weight: bold;
			padding: 0 10px;
			cursor: pointer;
			border: none;
			background: none;
			color: #E6E6E6;
			transition: all 0.2s ease;
			/* 定位 */
			position: absolute;
			top: 0;
			right: 0;
		}

		.close-btn:hover {
			background: #FF5F5F;
			color: #1E1E1E;
		}

		/* 主菜单 */
		.menu {
			padding: 8px 12px;
			border-radius: 2px;
			background: #2D2D2D;
			color: #E6E6E6;
			-webkit-user-select: none;
			user-select: none;
			z-index: 1;
			width: 50px;
			text-align: center;
			margin: 2px;
		}

		.menu>div {
			display: none;
			position: absolute;
			background: #2D2D2D;
			padding: 10px;
			border-radius: 2px;
			transition: .2s ease;
			box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
		}

		.menu>div>div {
			margin-top: 10px;
			padding: 5px 10px;
			border-radius: 2px;
			transition: all 0.15s ease;
		}

		.menu>div>div:hover {
			background: #3F3F3F;
			color: #4DACFF;
		}

		.menu:hover {
			background: #3F3F3F;
		}

		.menu:hover>div {
			display: block;
		}

		/* 下载提示 */
		#downloading {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: auto;
			padding: 12px;
			z-index: 1919810;
			display: none;
			background: #1A7D32;
			color: white;
		}

		/* 修改操作模式 */
		#mode {
			width: 100%;
			height: 50px;
			margin-top: 10px;
			margin-bottom: 10px;
			background: #252525;
			border-radius: 3px;
			padding: 5px;
		}

		/* 音符按钮样式 */
		.note-btn {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 5px 10px;
			margin: 0 4px;
			min-width: 40px;
			height: 40px;
			cursor: pointer;
			border: 1px solid #4A4A4A;
			border-radius: 3px;
			transition: all 0.15s ease;
			background-color: #3A3A3A;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
		}

		.note-btn:hover {
			background-color: #4A4A4A;
			border-color: #5A5A5A;
		}

		.note-btn.active {
			border-color: #2D96FF;
			background-color: #2A2A2A;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) inset;
			transform: translateY(2px);
		}

		.note-label {
			position: absolute;
			bottom: 1px;
			font-size: 10px;
			color: #B8B8B8;
		}

		body {
			touch-action: pan-x pan-y manipulation;
			/* 允许缩放和拖动，但禁用滚动 */
			overflow: hidden;
			/* 隐藏溢出的内容 */
			background-color: #1E1E1E;
			color: #E6E6E6;
			font-family: 'Segoe UI', Arial, sans-serif;
		}

		/* 时间层级选项 */
		.eventlayer-btn {
			border: 1px solid #4A4A4A;
			padding: 5px 8px;
			border-radius: 2px;
			margin: 1px;
			-webkit-user-select: none;
			user-select: none;
			height: 20px;
			margin-top: 10px;
			background: #3A3A3A;
			color: #E6E6E6;
			cursor: pointer;
			transition: all 0.15s ease;
		}

		.eventlayer-btn:hover {
			background: #4A4A4A;
			border-color: #5A5A5A;
		}

		select {
			-webkit-user-select: none;
			user-select: none;
			background: #3A3A3A;
			color: #E6E6E6;
			border: 1px solid #4A4A4A;
			border-radius: 2px;
			padding: 3px;
		}

		input {
			background: #3A3A3A;
			color: #E6E6E6;
			border: 1px solid #4A4A4A;
			border-radius: 2px;
			padding: 3px;
		}

		button {
			background: #3A3A3A;
			color: #E6E6E6;
			border: 1px solid #4A4A4A;
			border-radius: 2px;
			padding: 5px 10px;
			cursor: pointer;
			transition: all 0.15s ease;
		}

		button:hover {
			background: #4A4A4A;
			border-color: #5A5A5A;
		}

		/* 触控模式 */
		#mode>img {
			margin-left: 3px;
		}

		/* bpm list */
		.bpmlist-show {
			margin: 5px;
			display: flex;
			border: 1px solid #4A4A4A;
			padding: 10px;
			background: #2A2A2A;
			border-radius: 2px;
		}

		.bpmlist-show>input {
			height: 15px;
		}

		/* 下拉框 */
		#line-selector {
			-webkit-user-select: none;
			user-select: none;
		}

		#line-selected {
			border: 1px solid #4A4A4A;
			padding: 5px 10px;
			background: #3A3A3A;
			border-radius: 2px;
			cursor: pointer;
		}

		ul {
			display: block;
			position: absolute;
			background: #2D2D2D;
			margin-top: 0px;
			border: 1px solid #4A4A4A;
			overflow: auto;
			max-height: 70%;
			list-style: none;
			padding: 0px;
			border-radius: 2px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
		}

		li {
			border-bottom: 1px solid #3A3A3A;
			padding: 7px 10px;
			transition: .2s ease;
			-webkit-user-select: none;
			user-select: none;
		}

		li:hover {
			background-color: #3F3F3F;
		}

		li:last-child {
			border-bottom: none;
		}

		/* 滚动条 */
		#scrollbar {
			height: 30px;
			width: 12px;
			background: #4A4A4A;
			border-radius: 6px;
		}

		#scrollbar-container {
			width: 12px;
			border: 1px solid #3A3A3A;
			border-radius: 6px;
			background: #252525;
		}

		/* 美化滚动条 */
		::-webkit-scrollbar {
			width: 8px;
			height: 8px;
		}

		::-webkit-scrollbar-track {
			background: #252525;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb {
			background: #4A4A4A;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #5A5A5A;
		}

		/* 右键菜单 */
		#contextmenu {
			position: fixed;
			z-index: 114514;
			background: #2D2D2D;
			padding: 5px 0;
			display: none;
			border-radius: 3px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
			border: 1px solid #4A4A4A;
		}

		#contextmenu div {
			padding: 6px 12px;
			cursor: pointer;
			transition: all 0.15s ease;
		}

		#contextmenu div:hover {
			background-color: #3F3F3F;
			color: #4DACFF;
		}

		h3 {
			color: #4DACFF;
			border-bottom: 1px solid #3A3A3A;
			padding-bottom: 5px;
		}
	</style>
	<script src="./src/js/math.js"></script>
	<script src="./src/js/note.js"></script>
	<script src="./src/js/data.js"></script>
	<script src="./src/js/main.js"></script>
	<script src="./src/js/renderer.js"></script>
	<script src="./src/js/contextmenu.js"></script>

	<script>
		// 添加音符按钮选择反馈
		document.addEventListener('DOMContentLoaded', function () {
			// 按钮模式与全局mode变量的映射关系
			const modeMapping = {
				'computer': 'computer',
				'q': 'q',
				'w': 'w',
				'e': 'e',
				'r': 'r'
			};

			// 初始化
			setTimeout(() => {
				updateActiveNoteBtn(window.mode || 'computer');
			}, 500);

			// 为每个音符按钮添加点击处理
			const noteBtns = document.querySelectorAll('.note-btn');

			// 更新当前活动按钮
			function updateActiveNoteBtn(activeMode) {
				noteBtns.forEach(btn => {
					const btnMode = btn.getAttribute('data-mode');
					if (btnMode === activeMode) {
						btn.classList.add('active');
						btn.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.2) inset';
						btn.style.transform = 'translateY(2px)';
					} else {
						btn.classList.remove('active');
						btn.style.boxShadow = '';
						btn.style.transform = '';
					}
				});
			}

			// 监听全局mode变量变化（更频繁地检查，以确保UI反应迅速）
			setInterval(() => {
				if (window.mode) {
					updateActiveNoteBtn(window.mode);
				}
			}, 50);
		});
	</script>

	<!-- Vue App Initialization -->
	<!-- <script>
		// Create Vue app without interfering with existing JS
		const { createApp, ref, reactive } = Vue;

		// Initialize Vue app
		const vueApp = createApp({
			setup() {
				// Vue reactive state can be defined here
				const state = reactive({
					// Your Vue state can go here
				});

				// Methods can be defined here
				const methods = {
					// Your Vue methods can go here
				};

				return {
					...state,
					...methods
				};
			}
		});

		// Mount Vue to a non-critical element to avoid conflicts
		// This will allow Vue to be available without interfering with existing code
		document.addEventListener('DOMContentLoaded', function () {
			// Create a div for Vue to mount to
			const vueMount = document.createElement('div');
			vueMount.id = 'vue-app';
			vueMount.style.display = 'none'; // Hidden by default
			document.body.appendChild(vueMount);

			// Mount Vue app
			vueApp.mount('#vue-app');

			// 在使用jQuery之前先检查它是否已加载
			if (typeof jQuery !== 'undefined') {
				// jQuery 可用
				jQuery(function () {
					console.log('jQuery, Vue 3, and SweetAlert2 have been loaded');
				});
			} else {
				console.error('jQuery 未能加载，请检查网络连接或使用本地jQuery库');
			}
		});
	</script> -->

	<!-- 缓动类型选择器组件 -->
	<style>
		.ease-select-container {
			position: relative;
			width: 100%;
			margin-bottom: 10px;
		}

		.ease-select-header {
			display: flex;
			align-items: center;
			border: 1px solid #4A4A4A;
			padding: 5px;
			background: #3A3A3A;
			cursor: pointer;
			border-radius: 2px;
		}

		.ease-select-header img {
			width: 30px;
			height: 30px;
			margin-right: 10px;
			border: 1px solid #555;
		}

		.ease-select-options {
			position: absolute;
			width: 100%;
			max-height: 300px;
			overflow-y: auto;
			background: #2D2D2D;
			border: 1px solid #4A4A4A;
			border-radius: 2px;
			z-index: 1000;
			display: none;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
		}

		.ease-option {
			display: flex;
			align-items: center;
			padding: 5px;
			cursor: pointer;
			transition: all 0.15s ease;
		}

		.ease-option:hover {
			background: #3F3F3F;
		}

		.ease-option img {
			width: 30px;
			height: 30px;
			margin-right: 10px;
			border: 1px solid #555;
		}
	</style>

	<script>
		// 在页面加载完成后初始化自定义缓动选择器
		document.addEventListener('DOMContentLoaded', function () {
			// 缓动类型配置
			const easeOptions = [
				{ value: "1", text: "1 linear", image: "./src/img/math/1-linear.gif" },
				{ value: "2", text: "2 sin out", image: "./src/img/math/2-sin-out.gif" },
				{ value: "3", text: "3 sin in", image: "./src/img/math/3-sin-in.gif" },
				{ value: "4", text: "4 quad out", image: "./src/img/math/4-quad-out.gif" },
				{ value: "5", text: "5 quad in", image: "./src/img/math/5-quad-in.gif" },
				{ value: "6", text: "6 sin io", image: "./src/img/math/6-sin-io.gif" },
				{ value: "7", text: "7 quad io", image: "./src/img/math/7-quad-io.gif" },
				{ value: "8", text: "8 cubic out", image: "./src/img/math/8-cubic-out.gif" },
				{ value: "9", text: "9 cubic in", image: "./src/img/math/9-cubic-in.gif" },
				{ value: "10", text: "10 quart out", image: "./src/img/math/10-quart-out.gif" },
				{ value: "11", text: "11 quart in", image: "./src/img/math/11-quart-in.gif" },
				{ value: "12", text: "12 cubic io", image: "./src/img/math/12-cubic-io.gif" },
				{ value: "13", text: "13 quart io", image: "./src/img/math/13-quart-io.gif" },
				{ value: "14", text: "14 quint out", image: "./src/img/math/14-quint-out.gif" },
				{ value: "15", text: "15 quint in", image: "./src/img/math/15-quint-in.gif" },
				{ value: "16", text: "16 expo out", image: "./src/img/math/16-expo-out.gif" },
				{ value: "17", text: "17 expo in", image: "./src/img/math/17-expo-in.gif" },
				{ value: "18", text: "18 circ out", image: "./src/img/math/18-circ-out.gif" },
				{ value: "19", text: "19 circ in", image: "./src/img/math/19-circ-in.gif" },
				{ value: "20", text: "20 back out", image: "./src/img/math/20-back-out.gif" },
				{ value: "21", text: "21 back in", image: "./src/img/math/21-back-in.gif" },
				{ value: "22", text: "22 circ in", image: "./src/img/math/22-circ-in.gif" },
				{ value: "23", text: "23 back io", image: "./src/img/math/23-back-io.gif" },
				{ value: "24", text: "24 elastic out", image: "./src/img/math/24-elastic-out.gif" },
				{ value: "25", text: "25 elastic in", image: "./src/img/math/25-elastic-in.gif" },
				{ value: "26", text: "26 bounce out", image: "./src/img/math/26-bounce-out.gif" },
				{ value: "27", text: "27 bounce in", image: "./src/img/math/27-bounce-in.gif" },
				{ value: "28", text: "28 bounce io", image: "./src/img/math/28-bounce-io.gif" }
			];
			
			// 替换所有缓动选择器
			replaceEaseSelect('edit2-ease', easeOptions, 'edit2-container');
			replaceEaseSelect('edit4-ease', easeOptions, 'edit4-container');
			replaceEaseSelect('fillnotes-ease', easeOptions, 'fillnotes-container');
			
			// 全局存储自定义下拉选择器的映射，方便外部访问
			window.easeSelectContainers = {};
			
			// 创建自定义下拉框函数
			function replaceEaseSelect(selectId, options, containerId) {
				const originalSelect = document.getElementById(selectId);
				if (!originalSelect) return;
				
				// 获取当前选中的值
				const selectedValue = originalSelect.value;
				
				// 创建容器
				const container = document.createElement('div');
				container.className = 'ease-select-container';
				container.id = containerId;
				
				// 创建头部（显示当前选中项）
				const header = document.createElement('div');
				header.className = 'ease-select-header';
				
				// 找到当前选中的选项
				const selectedOption = options.find(opt => opt.value === selectedValue) || options[0];
				
				// 设置头部内容
				header.innerHTML = `
					<img src="${selectedOption.image}" alt="${selectedOption.text}">
					<span>${selectedOption.text}</span>
				`;
				
				// 创建选项容器
				const optionsContainer = document.createElement('div');
				optionsContainer.className = 'ease-select-options';
				
				// 添加所有选项
				options.forEach(option => {
					const optionElement = document.createElement('div');
					optionElement.className = 'ease-option';
					optionElement.dataset.value = option.value;
					optionElement.innerHTML = `
						<img src="${option.image}" alt="${option.text}">
						<span>${option.text}</span>
					`;
					
					// 点击选项时更新选中值
					optionElement.addEventListener('click', function () {
						// 更新头部显示
						header.innerHTML = `
							<img src="${option.image}" alt="${option.text}">
							<span>${option.text}</span>
						`;
						
						// 更新原始select的值
						originalSelect.value = option.value;
						
						// 触发原始select的change事件
						const event = new Event('change');
						originalSelect.dispatchEvent(event);
						
						// 隐藏选项列表
						optionsContainer.style.display = 'none';
					});
					
					optionsContainer.appendChild(optionElement);
				});
				
				// 点击头部时显示/隐藏选项列表
				header.addEventListener('click', function () {
					// 先隐藏所有其他的选项列表
					document.querySelectorAll('.ease-select-options').forEach(el => {
						if (el !== optionsContainer) {
							el.style.display = 'none';
						}
					});
					
					// 显示/隐藏当前选项列表
					const isVisible = optionsContainer.style.display === 'block';
					optionsContainer.style.display = isVisible ? 'none' : 'block';
				});
				
				// 点击外部时隐藏选项列表
				document.addEventListener('click', function (event) {
					if (!container.contains(event.target)) {
						optionsContainer.style.display = 'none';
					}
				});
				
				// 组装并替换原始select
				container.appendChild(header);
				container.appendChild(optionsContainer);
				originalSelect.style.display = 'none';
				originalSelect.parentNode.insertBefore(container, originalSelect.nextSibling);
				
				// 保存对原始select元素的引用，便于后续更新
				container.originalSelect = originalSelect;
				
				// 创建更新UI的函数
				function updateUI(value) {
					const option = options.find(opt => opt.value === value) || options[0];
					header.innerHTML = `
						<img src="${option.image}" alt="${option.text}">
						<span>${option.text}</span>
					`;
				}
				
				// 重写原始select的value属性setter
				const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype, 'value');
				Object.defineProperty(originalSelect, 'value', {
					set: function(val) {
						const result = originalDescriptor.set.call(this, val);
						updateUI(val);
						return result;
					},
					get: function() {
						return originalDescriptor.get.call(this);
					}
				});
				
				// 添加自定义更新方法
				container.updateValue = function(value) {
					updateUI(value);
				};
				
				// 存储到全局映射中
				window.easeSelectContainers[selectId] = container;
				
				// 监听原始select的change事件
				originalSelect.addEventListener('change', function() {
					updateUI(this.value);
				});
			}
		});
	</script>
</body>

</html>